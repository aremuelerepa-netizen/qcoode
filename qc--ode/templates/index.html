<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>QCode ‚Äî Digital Queue Management</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --ink:#0d0f14;--ink2:#1e2230;--ink3:#323848;
  --muted:#8892a4;--border:#e4e8f0;--bg:#f4f6fb;--white:#fff;
  --brand:#4361ee;--brand2:#3a0ca3;--cyan:#4cc9f0;--green:#06d6a0;
  --amber:#ffd166;--red:#ef4565;
  --fh:'Space Grotesk',sans-serif;--fb:'Plus Jakarta Sans',sans-serif;
  --r:.75rem;--rl:1.25rem;--rxl:1.75rem;
  --sh:0 2px 12px rgba(13,15,20,.09);--shm:0 6px 24px rgba(13,15,20,.13);--shl:0 16px 48px rgba(13,15,20,.18);
  --t:.2s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--bg);color:var(--ink);overflow-x:hidden}
h1,h2,h3{font-family:var(--fh);letter-spacing:-.03em;line-height:1.1}
.nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:1rem 2rem;display:flex;align-items:center;gap:1rem;transition:all var(--t)}
.nav.solid{background:rgba(13,15,20,.96);backdrop-filter:blur(16px)}
.nav-logo{display:flex;align-items:center;gap:.5rem;font-family:var(--fh);font-size:1.15rem;font-weight:700;color:#fff;text-decoration:none}
.nav-logo-dot{width:7px;height:7px;border-radius:50%;background:var(--cyan);animation:pd 2s ease infinite}
@keyframes pd{0%,100%{opacity:1}50%{opacity:.3}}
.nav-links{display:flex;gap:.25rem;margin-left:auto;align-items:center}
.nl{color:rgba(255,255,255,.65);font-size:.85rem;font-weight:500;padding:.4rem .875rem;border-radius:var(--r);transition:all var(--t);text-decoration:none}
.nl:hover{color:#fff;background:rgba(255,255,255,.1)}
.nav-cta{background:var(--brand);color:#fff;border-radius:var(--r);padding:.5rem 1.125rem;font-family:var(--fh);font-size:.85rem;font-weight:700;text-decoration:none;transition:all var(--t)}
.nav-cta:hover{background:var(--brand2);transform:translateY(-1px)}
.hero{min-height:100vh;background:linear-gradient(135deg,var(--ink2) 0%,var(--brand2) 55%,#0f172a 100%);display:flex;align-items:center;justify-content:center;text-align:center;padding:6rem 1.5rem 4rem;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 50% at 50% 70%,rgba(67,97,238,.25),transparent)}
.hero-inner{position:relative;max-width:780px}
.hero-badge{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:99px;padding:.4rem 1rem;font-size:.78rem;font-weight:600;color:rgba(255,255,255,.8);margin-bottom:2rem}
.hero-badge-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pd 1.5s ease infinite}
.hero h1{font-size:clamp(2.8rem,8vw,5.5rem);font-weight:800;color:#fff;margin-bottom:1.25rem}
.hero h1 span{background:linear-gradient(135deg,var(--cyan),var(--brand));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:1.1rem;color:rgba(255,255,255,.65);margin-bottom:2.5rem;line-height:1.7;max-width:560px;margin-left:auto;margin-right:auto}
.join-card{background:rgba(255,255,255,.97);border-radius:var(--rxl);padding:2rem;max-width:480px;margin:0 auto 1.75rem;box-shadow:var(--shl)}
.jc-label{font-family:var(--fh);font-size:.95rem;font-weight:700;color:var(--ink);margin-bottom:.3rem;text-align:left}
.jc-note{font-size:.78rem;color:var(--muted);margin-bottom:1.25rem;text-align:left;line-height:1.5}
.jc-note a{color:var(--brand);font-weight:600;text-decoration:none}
.jc-note a:hover{text-decoration:underline}
.inp-row{display:flex;gap:.625rem}
.inp{padding:.75rem 1rem;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r);font-family:var(--fb);font-size:.9rem;color:var(--ink);width:100%;transition:border-color var(--t),box-shadow var(--t)}
.inp:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 3px rgba(67,97,238,.15);background:var(--white)}
.inp::placeholder{color:var(--muted)}
.code-inp{text-transform:uppercase;letter-spacing:.15em;font-family:var(--fh);font-weight:700;font-size:1.05rem}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:.75rem 1.5rem;border-radius:var(--r);border:none;font-family:var(--fb);font-size:.9rem;font-weight:700;cursor:pointer;transition:all var(--t);white-space:nowrap;text-decoration:none}
.btn:disabled{opacity:.5;cursor:not-allowed}
.bp{background:var(--brand);color:#fff}.bp:hover:not(:disabled){background:var(--brand2);transform:translateY(-1px)}
.bg-btn{background:transparent;color:var(--ink3);border:1.5px solid var(--border)}.bg-btn:hover:not(:disabled){border-color:var(--brand);color:var(--brand)}
.btn-full{width:100%;display:flex}
.found-box{background:rgba(67,97,238,.06);border:1.5px solid rgba(67,97,238,.18);border-radius:var(--r);padding:.875rem 1.125rem;margin-bottom:1rem;text-align:left}
.found-name{font-weight:700;font-family:var(--fh);color:var(--ink)}
.found-meta{font-size:.78rem;color:var(--muted);margin-top:.375rem;display:flex;gap:.875rem;flex-wrap:wrap}
.ferr{font-size:.8rem;color:var(--red);margin-top:.375rem;display:none;text-align:left}
.divider{display:flex;align-items:center;gap:.75rem;margin:.875rem 0;color:var(--muted);font-size:.75rem}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.login-strip{display:flex;align-items:center;justify-content:space-between;gap:.5rem;background:rgba(67,97,238,.05);border:1px solid rgba(67,97,238,.15);border-radius:var(--r);padding:.65rem 1rem;font-size:.8rem;color:var(--ink3)}
.login-strip a{color:var(--brand);font-weight:700;text-decoration:none;white-space:nowrap}
.login-strip a:hover{text-decoration:underline}
.stats-bar{display:flex;gap:2rem;justify-content:center;flex-wrap:wrap;padding:1.75rem 2rem;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:var(--rl);max-width:520px;margin:0 auto}
.sb-item{text-align:center}
.sb-n{font-family:var(--fh);font-size:1.75rem;font-weight:800;color:#fff}
.sb-l{font-size:.72rem;color:rgba(255,255,255,.5);text-transform:uppercase;letter-spacing:.07em;margin-top:.125rem}
.lang-bar{display:flex;gap:.375rem;justify-content:center;flex-wrap:wrap;margin-bottom:1.25rem}
.lang-btn{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.65);border-radius:99px;padding:.25rem .75rem;font-family:var(--fb);font-size:.75rem;cursor:pointer;transition:all var(--t)}
.lang-btn.active,.lang-btn:hover{background:var(--brand);border-color:var(--brand);color:#fff}
.section{padding:5rem 1.5rem;max-width:1100px;margin:0 auto}
.section-title{font-size:clamp(1.75rem,4vw,2.75rem);color:var(--ink);text-align:center;margin-bottom:.75rem}
.section-sub{color:var(--muted);text-align:center;font-size:1rem;margin-bottom:3.5rem;line-height:1.65;max-width:540px;margin-left:auto;margin-right:auto}
.steps{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:2rem}
.step{text-align:center;padding:2rem 1.5rem;background:var(--white);border:1px solid var(--border);border-radius:var(--rxl);position:relative;overflow:hidden;transition:all var(--t)}
.step::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--brand),var(--cyan))}
.step:hover{transform:translateY(-4px);box-shadow:var(--shm)}
.step-num{width:48px;height:48px;border-radius:50%;background:rgba(67,97,238,.1);border:1.5px solid rgba(67,97,238,.2);display:flex;align-items:center;justify-content:center;font-family:var(--fh);font-size:1.1rem;font-weight:700;color:var(--brand);margin:0 auto 1.25rem}
.step h3{font-size:1rem;color:var(--ink);margin-bottom:.5rem}
.step p{font-size:.85rem;color:var(--muted);line-height:1.6}
.feats{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem}
.feat{background:var(--white);border:1px solid var(--border);border-radius:var(--rxl);padding:1.75rem;transition:all var(--t)}
.feat:hover{border-color:rgba(67,97,238,.3);box-shadow:var(--shm);transform:translateY(-2px)}
.feat-icon{font-size:2rem;margin-bottom:1rem}
.feat h3{font-size:1rem;color:var(--ink);margin-bottom:.5rem}
.feat p{font-size:.85rem;color:var(--muted);line-height:1.65}
.sms-section{background:linear-gradient(135deg,var(--ink2),var(--brand2));border-radius:2rem;padding:3.5rem;margin:0 1.5rem;display:flex;align-items:center;gap:3rem;flex-wrap:wrap}
.sms-left{flex:1;min-width:260px}
.sms-left h2{color:#fff;font-size:clamp(1.5rem,4vw,2.25rem);margin-bottom:.875rem}
.sms-left p{color:rgba(255,255,255,.65);line-height:1.7;margin-bottom:1.5rem;font-size:.95rem}
.sms-chip{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2);border-radius:99px;padding:.5rem 1.25rem;color:#fff;font-size:.875rem;font-weight:600}
.sms-chip strong{color:var(--cyan)}
.sms-steps{flex:1;min-width:260px;display:flex;flex-direction:column;gap:.875rem}
.sms-step{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:var(--rl);padding:1rem 1.25rem;display:flex;align-items:center;gap:.875rem}
.sms-step-num{width:32px;height:32px;border-radius:50%;background:var(--brand);display:flex;align-items:center;justify-content:center;font-family:var(--fh);font-weight:700;font-size:.85rem;color:#fff;flex-shrink:0}
.sms-step p{font-size:.85rem;color:rgba(255,255,255,.8);line-height:1.5}
.org-cta{background:var(--white);border-radius:2rem;padding:4rem;text-align:center;margin:0 1.5rem 5rem;border:1px solid var(--border);position:relative;overflow:hidden}
.org-cta::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 50% at 50% 100%,rgba(67,97,238,.06),transparent)}
.org-cta h2{font-size:clamp(1.75rem,4vw,2.5rem);margin-bottom:.875rem;position:relative}
.org-cta p{color:var(--muted);max-width:500px;margin:0 auto 2rem;line-height:1.7;position:relative}
.cta-btns{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;position:relative}
footer{background:var(--ink2);padding:2.5rem 2rem;text-align:center}
.footer-logo{display:flex;align-items:center;gap:.5rem;font-family:var(--fh);font-size:1.1rem;font-weight:700;color:#fff;justify-content:center;margin-bottom:.875rem}
footer p{font-size:.82rem;color:rgba(255,255,255,.35)}
footer a{color:rgba(255,255,255,.4);font-size:.82rem;text-decoration:none;margin:0 .625rem}
footer a:hover{color:rgba(255,255,255,.7)}
#toasts{position:fixed;top:1.25rem;right:1.25rem;z-index:999;display:flex;flex-direction:column;gap:.625rem;pointer-events:none}
.toast{padding:.75rem 1.125rem;border-radius:.625rem;box-shadow:var(--shl);font-size:.82rem;font-weight:600;display:flex;align-items:center;gap:.5rem;pointer-events:all;min-width:220px;animation:tIn .25s ease}
.t-s{background:#f0fdf4;border-left:3px solid var(--green);color:#047857}
.t-e{background:#fef2f2;border-left:3px solid var(--red);color:#b91c1c}
.t-i{background:#eff6ff;border-left:3px solid var(--brand);color:#1d4ed8}
@keyframes tIn{from{opacity:0;transform:translateX(1.5rem)}to{opacity:1;transform:none}}
/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
html{-webkit-text-size-adjust:100%;touch-action:manipulation}
*{-webkit-tap-highlight-color:transparent}
input,select,textarea,button{font-size:16px !important}
@media(max-width:700px){
  .sms-section{padding:2rem;flex-direction:column;gap:2rem;margin:0 1rem}
  .org-cta{padding:2.5rem 1.5rem;margin:0 1rem 3rem}
  .nav{padding:.875rem 1.25rem}
  .nav-links .nl{display:none}
}
@media(max-width:480px){
  .hero{padding:5rem 1rem 3rem}
  .hero h1{font-size:2.4rem}
  .hero-sub{font-size:.95rem}
  .join-card{padding:1.5rem 1.125rem;border-radius:1.25rem;margin-bottom:1.25rem}
  .jc-label{font-size:.9rem}
  .inp-row{flex-direction:row}
  .inp-row .inp{min-width:0}
  .stats-bar{gap:1.25rem;padding:1.25rem 1rem}
  .sb-n{font-size:1.4rem}
  .section{padding:3rem 1rem}
  .section-title{font-size:1.6rem}
  .feats{grid-template-columns:1fr}
  .steps{grid-template-columns:1fr}
  .sms-section{padding:1.5rem 1rem;margin:0 .5rem;border-radius:1.25rem}
  .org-cta{padding:2rem 1rem;margin:0 .5rem 3rem;border-radius:1.25rem}
  .cta-btns{flex-direction:column}
  .cta-btns .btn{width:100%!important}
  .lang-bar{gap:.25rem}
  .login-strip{font-size:.75rem;flex-direction:column;text-align:center;gap:.25rem}
}
</style>
</head>
<body>

<nav id="nav" class="nav">
  <a href="/" class="nav-logo">
    <svg width="26" height="26" viewBox="0 0 30 30" fill="none"><rect width="30" height="30" rx="7" fill="#4361ee"/><rect x="7" y="9" width="16" height="3" rx="1.5" fill="white"/><rect x="7" y="14" width="11" height="3" rx="1.5" fill="#a8c8ff"/><rect x="7" y="19" width="7" height="3" rx="1.5" fill="#7ea8ff"/></svg>
    QCode<span class="nav-logo-dot"></span>
  </a>
  <div class="nav-links">
    <a href="#how" class="nl">How it works</a>
    <a href="#features" class="nl">Features</a>
    <a href="/login-user" class="nl">Sign in</a>
    <a href="/register-org" class="nav-cta">For Orgs ‚Üí</a>
  </div>
</nav>

<section class="hero">
  <div class="hero-inner">
    <div class="lang-bar">
      <button class="lang-btn active" onclick="setLang('en')">EN</button>
      <button class="lang-btn" onclick="setLang('fr')">FR</button>
      <button class="lang-btn" onclick="setLang('ar')">AR</button>
      <button class="lang-btn" onclick="setLang('es')">ES</button>
      <button class="lang-btn" onclick="setLang('pt')">PT</button>
    </div>
    <div class="hero-badge"><span class="hero-badge-dot"></span> Live Queue Tracking</div>
    <h1 id="hero-h1">Queue Smarter,<br><span>Not Harder</span></h1>
    <p class="hero-sub" id="hero-sub">Join any queue with a service code ‚Äî no app needed. Real-time position tracking, SMS support, and instant notifications.</p>

    <!-- JOIN CARD ‚Äî GUEST ONLY -->
    <div class="join-card">
      <div class="jc-label" id="jc-title">Quick Join as Guest</div>
      <div class="jc-note" id="jc-note">In a hurry? Enter the code and join instantly. <a href="/login-user">Sign in</a> for notifications &amp; history.</div>

      <div id="step-code">
        <div class="inp-row" style="margin-bottom:.625rem">
          <input id="code-inp" class="inp code-inp" type="text" placeholder="e.g. VISA24" maxlength="8" autocomplete="off"/>
          <button class="btn bp" onclick="findService()" id="find-btn">Find</button>
        </div>
        <div id="code-err" class="ferr"></div>
      </div>

      <div id="step-found" style="display:none;margin-top:1rem">
        <div class="found-box">
          <div class="found-name" id="found-name"></div>
          <div class="found-meta">
            <span id="found-org"></span>
            <span id="found-eta"></span>
            <span id="found-waiting"></span>
          </div>
        </div>
        <input id="guest-name" class="inp" type="text" placeholder="Your full name (required)" style="margin-bottom:.75rem"/>
        <button class="btn bp btn-full" style="margin-bottom:.625rem" onclick="joinAsGuest()" id="join-btn">Join Queue as Guest</button>
        <div class="divider">or</div>
        <a href="/login-user" class="btn bg-btn btn-full" style="margin-bottom:.625rem">Sign in for full access</a>
        <button class="btn bg-btn btn-full" onclick="cancelFind()">‚Üê Cancel</button>
      </div>

      <div class="login-strip" id="login-strip">
        <span>Have an account?</span>
        <a href="/login-user">Sign in to join &amp; track ‚Üí</a>
      </div>
    </div>

    <div class="stats-bar">
      <div class="sb-item"><div class="sb-n" id="stat-orgs">‚Äî</div><div class="sb-l">Organizations</div></div>
      <div class="sb-item"><div class="sb-n" id="stat-served">‚Äî</div><div class="sb-l">People Served</div></div>
      <div class="sb-item"><div class="sb-n" id="stat-active">‚Äî</div><div class="sb-l">Active Queues</div></div>
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section class="section" id="how">
  <h2 class="section-title" id="how-title">How It Works</h2>
  <p class="section-sub" id="how-sub">Three simple steps to skip the physical wait</p>
  <div class="steps">
    <div class="step"><div class="step-num">1</div><h3>Get a Code</h3><p>Ask the organization for their service code ‚Äî or browse open queues after signing in.</p></div>
    <div class="step"><div class="step-num">2</div><h3>Join the Queue</h3><p>Enter the code here as a guest, or sign in for notifications and history. SMS joining also works.</p></div>
    <div class="step"><div class="step-num">3</div><h3>Show Up on Time</h3><p>Track your live position. Signed-in users get notified before their turn automatically.</p></div>
  </div>
</section>

<!-- FEATURES -->
<section class="section" id="features" style="padding-top:0">
  <h2 class="section-title">Everything You Need</h2>
  <p class="section-sub">Powerful features for users and organizations alike</p>
  <div class="feats">
    <div class="feat"><div class="feat-icon">üì°</div><h3>Real-Time Tracking</h3><p>Watch your position update live. Know exactly when it's your turn without refreshing.</p></div>
    <div class="feat"><div class="feat-icon">üì±</div><h3>SMS Without Internet</h3><p>No smartphone? No problem. Text a service code to join a queue from any phone.</p></div>
    <div class="feat"><div class="feat-icon">üîî</div><h3>Smart Notifications</h3><p>Signed-in users get browser alerts before their turn. You'll always have time to show up.</p></div>
    <div class="feat"><div class="feat-icon">üè¢</div><h3>For Organizations</h3><p>Create services, manage queues, set schedules, break times, and view reports ‚Äî all in one place.</p></div>
    <div class="feat"><div class="feat-icon">üåç</div><h3>Multi-Language</h3><p>Available in English, French, Arabic, Spanish, and Portuguese to serve global communities.</p></div>
    <div class="feat"><div class="feat-icon">ü§ñ</div><h3>AI-Powered Help</h3><p>Ask our AI assistant any question about your queue, wait time, or how the system works.</p></div>
  </div>
</section>

<!-- SMS SECTION -->
<div style="max-width:1100px;margin:0 auto;padding-bottom:5rem">
<div class="sms-section">
  <div class="sms-left">
    <h2>Join by SMS ‚Äî No Internet Needed</h2>
    <p>In areas with limited internet, users can join any queue by simply texting the service code to our gateway number. Instant confirmation sent back.</p>
    <div class="sms-chip">Text to <strong>+2349155189936</strong></div>
  </div>
  <div class="sms-steps">
    <div class="sms-step"><div class="sms-step-num">1</div><p>Ask for the service code from the organization (e.g. <strong>VISA24</strong>)</p></div>
    <div class="sms-step"><div class="sms-step-num">2</div><p>Text the code to <strong>+2349155189936</strong> from any mobile phone</p></div>
    <div class="sms-step"><div class="sms-step-num">3</div><p>Receive your ticket number and estimated wait time by SMS</p></div>
  </div>
</div>
</div>

<!-- ORG CTA -->
<div class="org-cta">
  <h2>Ready to Manage Your Queues?</h2>
  <p>Register your organization for free and start creating digital queue services in minutes. No hardware required.</p>
  <div class="cta-btns">
    <a href="/register-org" class="btn bp" style="padding:.875rem 2rem;font-size:1rem">Register Organization ‚Üí</a>
    <a href="/login-org" class="btn bg-btn" style="padding:.875rem 2rem;font-size:1rem">Org Sign In</a>
  </div>
</div>

<footer>
  <div class="footer-logo">
    <svg width="22" height="22" viewBox="0 0 30 30" fill="none"><rect width="30" height="30" rx="7" fill="#4361ee"/><rect x="7" y="9" width="16" height="3" rx="1.5" fill="white"/><rect x="7" y="14" width="11" height="3" rx="1.5" fill="#a8c8ff"/><rect x="7" y="19" width="7" height="3" rx="1.5" fill="#7ea8ff"/></svg>
    QCode
  </div>
  <p>¬© 2025 QCode. Digital queue management for everyone.</p>
  <div style="margin-top:.875rem">
    <a href="/login-user">User Login</a>
    <a href="/login-org">Org Login</a>
    <a href="/register-user">Register</a>
    <a href="/register-org">Org Register</a>
  </div>
</footer>

<div id="toasts"></div>

<script>
const TRANSLATIONS = {
  en:{h1:'Queue Smarter,\nNot Harder',sub:'Join any queue with a service code ‚Äî no app needed. Real-time position tracking, SMS support, and instant notifications.',jcTitle:'Quick Join as Guest',jcNote:'In a hurry? Enter the code and join instantly. <a href="/login-user">Sign in</a> for notifications & history.',howTitle:'How It Works',howSub:'Three simple steps to skip the physical wait'},
  fr:{h1:'Faites la queue\nautrement',sub:"Rejoignez n'importe quelle file avec un code de service.",jcTitle:'Rejoindre comme invit√©',jcNote:'Entrez le code et rejoignez instantan√©ment. <a href="/login-user">Connexion</a> pour les notifications.',howTitle:'Comment √ßa marche',howSub:"Trois √©tapes simples"},
  ar:{h1:'ÿßŸÜÿ™ÿ∏ÿ± ÿ®ÿ∞ŸÉÿßÿ°ÿå\nŸÑÿß ÿ®ÿßŸÑÿµŸÅ',sub:'ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ÿ£Ÿä ÿ∑ÿßÿ®Ÿàÿ± ÿ®ŸÉŸàÿØ ÿßŸÑÿÆÿØŸÖÿ©.',jcTitle:'ÿßŸÜÿ∂ŸÖÿßŸÖ ÿ≥ÿ±Ÿäÿπ ŸÉÿ∂ŸäŸÅ',jcNote:'ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸàÿØ ŸàÿßŸÜÿ∂ŸÖ ŸÅŸàÿ±ÿßŸã. <a href="/login-user">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</a> ŸÑŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™.',howTitle:'ŸÉŸäŸÅ ŸäÿπŸÖŸÑ',howSub:'ÿ´ŸÑÿßÿ´ ÿÆÿ∑Ÿàÿßÿ™ ÿ®ÿ≥Ÿäÿ∑ÿ©'},
  es:{h1:'Haz Cola\nde Forma Inteligente',sub:'√önete a cualquier cola con un c√≥digo de servicio.',jcTitle:'Unirse como invitado',jcNote:'Ingresa el c√≥digo y √∫nete al instante. <a href="/login-user">Iniciar sesi√≥n</a> para notificaciones.',howTitle:'C√≥mo Funciona',howSub:'Tres pasos simples'},
  pt:{h1:'Fique na Fila\nde Forma Inteligente',sub:'Junte-se a qualquer fila com um c√≥digo de servi√ßo.',jcTitle:'Entrar como convidado',jcNote:'Digite o c√≥digo e entre instantaneamente. <a href="/login-user">Entrar</a> para notifica√ß√µes.',howTitle:'Como Funciona',howSub:'Tr√™s passos simples'}
};

let foundSvc = null;

function setLang(l) {
  document.documentElement.lang = l;
  document.documentElement.dir = l==='ar'?'rtl':'ltr';
  document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active',b.textContent===l.toUpperCase()));
  const t = TRANSLATIONS[l]||TRANSLATIONS.en;
  const parts = t.h1.split('\n');
  document.getElementById('hero-h1').innerHTML = parts[0]+'<br><span>'+(parts[1]||'')+'</span>';
  document.getElementById('hero-sub').textContent = t.sub;
  document.getElementById('jc-title').textContent = t.jcTitle;
  document.getElementById('jc-note').innerHTML = t.jcNote;
  document.getElementById('how-title').textContent = t.howTitle;
  document.getElementById('how-sub').textContent = t.howSub;
  localStorage.setItem('qcode_lang',l);
}

function toast(msg,type='i',ms=4500){
  const el=document.createElement('div');
  el.className='toast t-'+type;
  el.textContent=msg;
  document.getElementById('toasts').appendChild(el);
  setTimeout(()=>el.remove(),ms);
}

async function findService(){
  const code=document.getElementById('code-inp').value.trim().toUpperCase();
  const errEl=document.getElementById('code-err');
  const btn=document.getElementById('find-btn');
  errEl.style.display='none';
  if(!code){errEl.textContent='Please enter a service code.';errEl.style.display='block';return;}
  btn.disabled=true;btn.textContent='‚Ä¶';
  const r=await fetch('/api/user/find-service?code='+encodeURIComponent(code));
  btn.disabled=false;btn.textContent='Find';
  if(!r.ok){const d=await r.json().catch(()=>({}));errEl.textContent=d.error||'Service not found.';errEl.style.display='block';return;}
  foundSvc=await r.json();
  document.getElementById('found-name').textContent=foundSvc.name;
  document.getElementById('found-org').textContent=foundSvc.org_name?'üè¢ '+foundSvc.org_name:'';
  document.getElementById('found-eta').textContent='‚è± ~'+(foundSvc.eta_minutes||0)+' min wait';
  document.getElementById('found-waiting').textContent='üë• '+(foundSvc.waiting_count||0)+' waiting';
  document.getElementById('step-code').style.display='none';
  document.getElementById('step-found').style.display='block';
  document.getElementById('login-strip').style.display='none';
}

function cancelFind(){
  foundSvc=null;
  document.getElementById('step-found').style.display='none';
  document.getElementById('step-code').style.display='block';
  document.getElementById('code-inp').value='';
  document.getElementById('code-err').style.display='none';
  document.getElementById('login-strip').style.display='flex';
}

async function joinAsGuest(){
  if(!foundSvc)return;
  const btn=document.getElementById('join-btn');
  const gname=(document.getElementById('guest-name').value||'').trim();
  if(!gname){toast('Please enter your full name.','e');return;}
  btn.disabled=true;btn.textContent='Joining‚Ä¶';
  const r=await fetch('/api/guest/join',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({service_id:foundSvc.id,guest_name:gname})
  });
  const data=await r.json().catch(()=>({}));
  btn.disabled=false;btn.textContent='Join Queue as Guest';
  if(!r.ok){toast(data.error||'Failed to join queue.','e');return;}
  sessionStorage.setItem('qc_guest',JSON.stringify(data));
  window.location.href='/guest';
}

async function loadStats(){
  try{
    const r=await fetch('/api/public/stats');
    if(!r.ok)return;
    const d=await r.json();
    document.getElementById('stat-orgs').textContent=d.approved_orgs||0;
    document.getElementById('stat-served').textContent=d.total_served||0;
    document.getElementById('stat-active').textContent=d.active_services||0;
  }catch(e){}
}

async function checkSession(){
  // Never auto-redirect on the homepage.
  // If the user is already logged in, just show a dashboard button in the nav.
  try{
    const r=await fetch('/api/auth/me',{credentials:'include'});
    if(!r.ok)return;
    const d=await r.json();
    if(d.logged_in){
      const dash=d.role==='organization'?'/org':d.role==='super_admin'?'/super-admin':'/user';
      const navLinks=document.querySelector('.nav-links');
      if(navLinks){
        const signInLink=navLinks.querySelector('a[href="/login-user"]');
        if(signInLink)signInLink.remove();
        const btn=document.createElement('a');
        btn.href=dash;
        btn.className='nav-cta';
        btn.textContent='My Dashboard ‚Üí';
        navLinks.insertBefore(btn,navLinks.querySelector('.nav-cta'));
      }
    }
  }catch(e){}
}

window.addEventListener('scroll',()=>{
  document.getElementById('nav').classList.toggle('solid',window.scrollY>40);
});
document.getElementById('code-inp').addEventListener('input',function(){
  this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,'');
});
document.getElementById('code-inp').addEventListener('keydown',e=>{if(e.key==='Enter')findService();});
document.getElementById('guest-name').addEventListener('keydown',e=>{if(e.key==='Enter')joinAsGuest();});

const sl=localStorage.getItem('qcode_lang');
if(sl&&TRANSLATIONS[sl])setLang(sl);

checkSession();
loadStats();
</script>
</body>
</html>
