<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Create Account — QCode</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <style>
    :root{--navy:#0a1628;--blue:#1a3a6b;--accent:#2563eb;--cyan:#06b6d4;--s50:#f8fafc;--s300:#cbd5e1;--s500:#64748b;--s700:#334155;--s900:#0f172a;--green:#22c55e;--red:#ef4444;--fh:'Syne',sans-serif;--fb:'DM Sans',sans-serif;--r:.625rem;--t:.2s ease}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--fb);min-height:100vh;background:linear-gradient(135deg,var(--navy),var(--blue) 55%,#0f172a);display:flex;align-items:center;justify-content:center;padding:2rem 1rem}
    h1{font-family:var(--fh);letter-spacing:-.02em}
    a{color:var(--accent);text-decoration:none}
    .wrap{width:100%;max-width:460px}
    .logo{display:flex;align-items:center;gap:.5rem;font-family:var(--fh);font-size:1.4rem;font-weight:800;color:#fff;margin-bottom:2rem}
    .logo span{color:var(--cyan)}
    .card{background:#fff;border-radius:1.25rem;padding:2.5rem;box-shadow:0 16px 48px rgba(10,22,40,.2)}
    .title{font-size:1.5rem;color:var(--navy);margin-bottom:.375rem}
    .sub{font-size:.875rem;color:var(--s500);margin-bottom:2rem;line-height:1.5}
    .fg{display:flex;flex-direction:column;gap:.375rem;margin-bottom:1.125rem}
    .lbl{font-size:.85rem;font-weight:600;color:var(--s700)}.hint{font-size:.78rem;color:var(--s500)}
    .inp{padding:.8rem 1rem;background:var(--s50);border:1.5px solid var(--s300);border-radius:var(--r);font-family:var(--fb);font-size:.9rem;color:var(--s900);width:100%;transition:border-color var(--t),box-shadow var(--t)}
    .inp:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,.12);background:#fff}
    .inp::placeholder{color:var(--s300)}
    select.inp{cursor:pointer}
    .err{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3);border-radius:var(--r);padding:.75rem 1rem;font-size:.825rem;color:#b91c1c;display:none;margin-bottom:1rem}
    .ok{background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.3);border-radius:var(--r);padding:.75rem 1rem;font-size:.825rem;color:#15803d;display:none;margin-bottom:1rem}
    .btn{display:flex;align-items:center;justify-content:center;width:100%;padding:1rem;border-radius:var(--r);border:none;font-family:var(--fb);font-size:1rem;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;transition:all var(--t)}
    .btn:hover:not(:disabled){background:#1d4ed8}.btn:disabled{opacity:.5;cursor:not-allowed}
    .sw{text-align:center;margin-top:1.25rem;font-size:.875rem;color:var(--s500)}
    .back{display:block;text-align:center;margin-top:.75rem;font-size:.8rem;color:rgba(255,255,255,.4)}
  </style>
</head>
<body>
<div class="wrap">
  <a href="../index.html" class="logo">
    <svg width="28" height="28" viewBox="0 0 30 30" fill="none"><rect width="30" height="30" rx="8" fill="#2563eb"/><rect x="8" y="9" width="14" height="3" rx="1.5" fill="white"/><rect x="8" y="14" width="10" height="3" rx="1.5" fill="#93c5fd"/><rect x="8" y="19" width="6" height="3" rx="1.5" fill="#60a5fa"/></svg>
    <span>Q<span style="color:#fff">Code</span></span>
  </a>
  <div class="card">
    <h1 class="title">Create your account</h1>
    <p class="sub">Join QCode to track queues, see your history, and get real-time alerts.</p>
    <div id="err" class="err"></div>
    <div id="ok" class="ok"></div>
    <div class="fg"><label class="lbl">Full Name *</label><input id="name" class="inp" type="text" placeholder="Your full name"/></div>
    <div class="fg"><label class="lbl">Email Address *</label><input id="email" class="inp" type="email" placeholder="you@example.com"/></div>
    <div class="fg"><label class="lbl">Phone Number (optional)</label><input id="phone" class="inp" type="tel" placeholder="+1 234 567 8900"/><span class="hint">For SMS queue updates</span></div>
    <div class="fg"><label class="lbl">Preferred Language</label>
      <select id="lang" class="inp">
        <option value="en">English</option><option value="fr">Français</option>
        <option value="ar">العربية</option><option value="es">Español</option><option value="pt">Português</option>
      </select>
    </div>
    <div class="fg"><label class="lbl">Password *</label><input id="password" class="inp" type="password" placeholder="Minimum 8 characters"/></div>
    <div class="fg"><label class="lbl">Confirm Password *</label><input id="confirm" class="inp" type="password" placeholder="Repeat password"/></div>
    <button id="btn" class="btn" onclick="register()">Create Account</button>
    <div class="sw">Already have an account? <a href="login-user">Sign in →</a></div>
    <div class="sw" style="margin-top:.375rem"><a href="register-org" style="color:#94a3b8;font-size:.8rem">Registering an organization? →</a></div>
  </div>
  <a href="../index.html" class="back">← Back to home</a>
</div>
<script>
async function register() {
  const err = document.getElementById('err');
  const ok  = document.getElementById('ok');
  const btn = document.getElementById('btn');
  err.style.display = 'none';
  ok.style.display  = 'none';

  const name     = document.getElementById('name').value.trim();
  const email    = document.getElementById('email').value.trim();
  const phone    = document.getElementById('phone').value.trim();
  const lang     = document.getElementById('lang').value;
  const password = document.getElementById('password').value;
  const confirm  = document.getElementById('confirm').value;

  if (!name || !email || !password) { showErr('Name, email and password are required.'); return; }
  if (password.length < 8)          { showErr('Password must be at least 8 characters.'); return; }
  if (password !== confirm)          { showErr('Passwords do not match.'); return; }

  btn.disabled = true;
  btn.textContent = 'Creating account…';

  try {
    const res  = await fetch('/api/auth/register-user', {
      method:  'POST',
      headers: {'Content-Type': 'application/json'},
      body:    JSON.stringify({ full_name: name, email, phone, password, preferred_lang: lang }),
    });
    const data = await res.json();

    if (!res.ok) {
      showErr(data.error || 'Registration failed. Please try again.');
      btn.disabled = false;
      btn.textContent = 'Create Account';
      return;
    }

    // Success
    ok.textContent  = data.message || 'Account created! Redirecting to login…';
    ok.style.display = 'block';
    btn.textContent  = '✓ Account created!';
    setTimeout(() => { window.location.href = '/login-user'; }, 2500);

  } catch(e) {
    showErr('Network error. Please check your connection and try again.');
    btn.disabled    = false;
    btn.textContent = 'Create Account';
  }
}

function showErr(msg) {
  const el = document.getElementById('err');
  el.textContent  = msg;
  el.style.display = 'block';
}

document.addEventListener('keydown', e => { if (e.key === 'Enter') register(); });
</script>
</body>
</html>
